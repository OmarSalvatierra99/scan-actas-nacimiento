<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esc√°ner de Actas | OFS Tlaxcala</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <!-- jsQR para decodificar QR en el navegador -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <img src="{{ url_for('static', filename='img/ofs_logo.png') }}" alt="Logo OFS Tlaxcala" class="ofs-logo" />
        <div class="header-text">
          <h1>Esc√°ner de Actas de Nacimiento</h1>
          <p>Sistema oficial de digitalizaci√≥n y registro de actas</p>
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <img src="{{ url_for('static', filename='img/avatar_default.png') }}" alt="Usuario" class="avatar" />
          <div>
            <h2>Gobierno del Estado de Tlaxcala</h2>
            <p>√ìrgano de Fiscalizaci√≥n Superior</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="scan-methods">
      <div class="method-tabs">
        <button class="tab-btn active" data-tab="pdf">üìÑ Subir Acta PDF</button>
        <button class="tab-btn" data-tab="usb">üîå Lector QR USB</button>
        <button class="tab-btn" data-tab="cam">üì∑ C√°mara del navegador</button>
      </div>

      <!-- ===== PDF ===== -->
      <div id="pdf-tab" class="tab-content active">
        <div class="pdf-container">
          <div class="pdf-instructions">
            <h3>üìã Instrucciones para procesar actas PDF</h3>
            <ol>
              <li>Arrastre y suelte uno o m√∫ltiples archivos PDF en la zona de carga</li>
              <li>El sistema detectar√° autom√°ticamente c√≥digos QR o extraer√° datos del texto</li>
              <li>Procese hasta cientos de actas simult√°neamente con seguimiento en tiempo real</li>
              <li>Los registros v√°lidos se agregar√°n autom√°ticamente a la tabla</li>
            </ol>
          </div>

          <!-- Dropzone para Drag & Drop -->
          <div id="dropzone" class="dropzone">
            <span class="dropzone-icon">üìÅ</span>
            <div class="dropzone-text">Arrastre archivos PDF aqu√≠</div>
            <div class="dropzone-hint">o haga clic para seleccionar archivos (puede seleccionar m√∫ltiples)</div>
            <input type="file" id="pdfInput" accept=".pdf" multiple style="display: none;">
          </div>

          <!-- Lista de archivos seleccionados -->
          <div id="fileList" class="file-list" style="display: none;"></div>

          <!-- Controles de procesamiento batch -->
          <div id="batchControls" class="batch-controls" style="display: none;">
            <button id="btnProcessBatch" class="btn btn-primary">
              üöÄ Procesar todos los archivos (<span id="fileCount">0</span>)
            </button>
            <button id="btnClearFiles" class="btn btn-error">
              üóëÔ∏è Limpiar lista
            </button>
          </div>

          <!-- Progreso general -->
          <div id="overallProgress" style="display: none; margin-top: 1.5rem;">
            <div style="margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center;">
              <span style="font-weight: 600; color: var(--color-primary);">
                <span class="spinner" style="margin-right: 0.5rem;"></span>
                Procesando: <span id="progressText">0 de 0</span>
              </span>
              <span style="color: var(--color-muted); font-size: 0.9rem;">
                <span id="successCount">0</span> exitosos ¬∑ <span id="errorCount">0</span> errores
              </span>
            </div>
            <div class="progress-bar-container">
              <div id="overallProgressBar" class="progress-bar" style="width: 0%;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== USB ===== -->
      <div id="usb-tab" class="tab-content">
        <div class="usb-container">
          <div class="usb-instructions">
            <h3>Instrucciones para lector QR USB</h3>
            <ol>
              <li>Conecte el lector QR USB.</li>
              <li>Haga clic en el campo de texto.</li>
              <li>Escanee el QR y presione ENTER.</li>
            </ol>
          </div>

          <div class="form-group">
            <label for="usbInput">Datos del lector USB</label>
            <input type="text" id="usbInput" class="usb-input" placeholder="Haga clic aqu√≠ y escanee..." />
          </div>
          <button id="btnProcessUSB" class="btn btn-primary" disabled>üíæ Guardar Acta</button>
        </div>
      </div>

      <!-- ===== C√ÅMARA ===== -->
      <div id="cam-tab" class="tab-content">
        <div class="cam-container">
          <div class="usb-instructions">
            <h3>Escaneo con c√°mara del navegador</h3>
            <ol>
              <li>Concede permiso a la c√°mara.</li>
              <li>Coloca el QR dentro del recuadro.</li>
              <li>El sistema registrar√° autom√°ticamente al detectar un QR v√°lido.</li>
            </ol>
          </div>

          <div class="cam-preview">
            <video id="camVideo" playsinline muted></video>
            <canvas id="camCanvas" style="display:none;"></canvas>
            <div class="cam-frame"></div>
          </div>

          <div class="cam-controls">
            <button id="btnStartCam" class="btn btn-primary">‚ñ∂ Iniciar c√°mara</button>
            <button id="btnStopCam" class="btn btn-error" disabled>‚ñ† Detener</button>
            <span id="camStatus" class="cam-status">Inactiva</span>
          </div>
        </div>
      </div>
    </section>

    <div id="resultMessage" class="result-message"></div>

    <section class="controls-panel">
      <div class="stats">
        Total de actas escaneadas: <strong id="totalRegistros">{{ total }}</strong>
      </div>
      <div class="actions">
        <a href="{{ url_for('descargar_excel') }}" class="btn btn-download">üì• Descargar Excel</a>
        <button id="btnLimpiar" class="btn btn-error">üóëÔ∏è Limpiar Todo</button>
      </div>
    </section>

    <section class="table-panel">
      <h2>üìã Actas Escaneadas (m√°s recientes primero)</h2>

      <!-- Controles de tabla: b√∫squeda y filtros -->
      <div class="table-controls">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Buscar por nombre, CURP, municipio..."
          />
        </div>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <span style="color: var(--color-muted); font-size: 0.9rem;">Mostrar:</span>
          <select id="rowsPerPage" style="padding: 0.5rem; border: 1px solid var(--color-border); border-radius: var(--radius-sm);">
            <option value="10">10 filas</option>
            <option value="25" selected>25 filas</option>
            <option value="50">50 filas</option>
            <option value="100">100 filas</option>
            <option value="all">Todas</option>
          </select>
        </div>
      </div>

      <div id="tablaRegistros">{% include '_tabla_registros.html' %}</div>

      <!-- Paginaci√≥n -->
      <div id="pagination" class="pagination"></div>
    </section>
  </main>

  <footer class="footer">
    <p>&copy; {{ current_year }} Gobierno del Estado de Tlaxcala ¬∑ √ìrgano de Fiscalizaci√≥n Superior</p>
  </footer>

  <script>
    // ===== STATE =====
    let selectedFiles = [];
    let allRegistros = [];
    let currentPage = 1;
    let rowsPerPage = 25;

    // ===== Tabs =====
    document.addEventListener('DOMContentLoaded', () => {
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.getAttribute('data-tab');
          tabButtons.forEach(b => b.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById(`${tab}-tab`).classList.add('active');
          if (tab === 'usb') setTimeout(() => document.getElementById('usbInput')?.focus(), 200);
        });
      });

      // Inicializar b√∫squeda y paginaci√≥n
      initTableFeatures();
    });

    // ===== USB input =====
    const usbInput = document.getElementById('usbInput');
    const btnProcessUSB = document.getElementById('btnProcessUSB');
    if (usbInput) {
      usbInput.addEventListener('input', () => {
        btnProcessUSB.disabled = usbInput.value.trim().length === 0;
      });
      btnProcessUSB.addEventListener('click', async () => {
        const v = usbInput.value.trim();
        if (!v) return;
        await postQR(v);
        usbInput.value = '';
        btnProcessUSB.disabled = true;
        usbInput.focus();
      });
      usbInput.addEventListener('keydown', async (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          btnProcessUSB.click();
        }
      });
    }

    // ===== DRAG & DROP PDF =====
    const dropzone = document.getElementById('dropzone');
    const pdfInput = document.getElementById('pdfInput');
    const fileList = document.getElementById('fileList');
    const batchControls = document.getElementById('batchControls');
    const btnProcessBatch = document.getElementById('btnProcessBatch');
    const btnClearFiles = document.getElementById('btnClearFiles');
    const fileCountSpan = document.getElementById('fileCount');

    // Click en dropzone abre selector de archivos
    dropzone?.addEventListener('click', () => pdfInput?.click());

    // Prevenir comportamiento por defecto en drag & drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropzone?.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // Efectos visuales para drag & drop
    ['dragenter', 'dragover'].forEach(eventName => {
      dropzone?.addEventListener(eventName, () => {
        dropzone.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropzone?.addEventListener(eventName, () => {
        dropzone.classList.remove('dragover');
      });
    });

    // Manejar archivos soltados
    dropzone?.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = [...dt.files].filter(f => f.type === 'application/pdf');
      handleFiles(files);
    });

    // Manejar archivos seleccionados
    pdfInput?.addEventListener('change', (e) => {
      const files = [...e.target.files];
      handleFiles(files);
      pdfInput.value = ''; // Reset input
    });

    function handleFiles(files) {
      if (files.length === 0) return;

      // Agregar archivos nuevos evitando duplicados
      files.forEach(file => {
        if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
          selectedFiles.push({
            file: file,
            status: 'pending',
            message: ''
          });
        }
      });

      updateFileList();
      updateBatchControls();
    }

    function updateFileList() {
      if (selectedFiles.length === 0) {
        fileList.style.display = 'none';
        return;
      }

      fileList.style.display = 'block';
      fileList.innerHTML = selectedFiles.map((item, index) => {
        const statusClass = item.status === 'success' ? 'success' : item.status === 'error' ? 'error' : item.status === 'processing' ? 'processing' : '';
        const statusIcon = item.status === 'success' ? '‚úì' : item.status === 'error' ? '‚úó' : item.status === 'processing' ? '<span class="spinner"></span>' : '‚è≥';
        const statusText = item.status === 'success' ? 'Completado' : item.status === 'error' ? 'Error' : item.status === 'processing' ? 'Procesando...' : 'Pendiente';

        return `
          <div class="file-item">
            <div class="file-info">
              <span class="file-icon">üìÑ</span>
              <div class="file-details">
                <div class="file-name">${item.file.name}</div>
                <div class="file-size">${formatFileSize(item.file.size)}</div>
                ${item.message ? `<div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 0.25rem;">${item.message}</div>` : ''}
              </div>
            </div>
            <div class="file-status ${statusClass}">
              ${statusIcon} ${statusText}
            </div>
            ${item.status === 'pending' ? `<button class="file-remove" onclick="removeFile(${index})">‚úï</button>` : ''}
          </div>
        `;
      }).join('');
    }

    function removeFile(index) {
      selectedFiles.splice(index, 1);
      updateFileList();
      updateBatchControls();
    }

    function updateBatchControls() {
      const pendingCount = selectedFiles.filter(f => f.status === 'pending').length;

      if (selectedFiles.length === 0) {
        batchControls.style.display = 'none';
      } else {
        batchControls.style.display = 'flex';
        fileCountSpan.textContent = pendingCount;
        btnProcessBatch.disabled = pendingCount === 0;
      }
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // Procesar todos los archivos en batch
    btnProcessBatch?.addEventListener('click', async () => {
      const pendingFiles = selectedFiles.filter(f => f.status === 'pending');
      if (pendingFiles.length === 0) return;

      btnProcessBatch.disabled = true;
      btnClearFiles.disabled = true;

      const overallProgress = document.getElementById('overallProgress');
      const progressBar = document.getElementById('overallProgressBar');
      const progressText = document.getElementById('progressText');
      const successCountEl = document.getElementById('successCount');
      const errorCountEl = document.getElementById('errorCount');

      overallProgress.style.display = 'block';

      let completed = 0;
      let successCount = 0;
      let errorCount = 0;
      const total = pendingFiles.length;

      // Procesar archivos secuencialmente para evitar sobrecarga
      for (let i = 0; i < selectedFiles.length; i++) {
        const item = selectedFiles[i];
        if (item.status !== 'pending') continue;

        item.status = 'processing';
        updateFileList();

        try {
          const formData = new FormData();
          formData.append('pdf_file', item.file);

          const response = await fetch('/procesar_pdf', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();

          if (data.success) {
            item.status = 'success';
            item.message = data.message || 'Procesado correctamente';
            successCount++;

            // Actualizar tabla
            if (data.tabla_html) {
              refreshTable(data.tabla_html, data.total_registros);
            }
          } else {
            item.status = 'error';
            item.message = data.message || 'Error al procesar';
            errorCount++;
          }
        } catch (error) {
          item.status = 'error';
          item.message = 'Error de conexi√≥n';
          errorCount++;
        }

        completed++;
        const progress = (completed / total) * 100;
        progressBar.style.width = progress + '%';
        progressText.textContent = `${completed} de ${total}`;
        successCountEl.textContent = successCount;
        errorCountEl.textContent = errorCount;

        updateFileList();
      }

      btnClearFiles.disabled = false;

      // Ocultar barra de progreso despu√©s de 2 segundos
      setTimeout(() => {
        overallProgress.style.display = 'none';
        progressBar.style.width = '0%';
      }, 2000);

      showMessage(true, `Procesamiento completado: ${successCount} exitosos, ${errorCount} errores`);
    });

    // Limpiar lista de archivos
    btnClearFiles?.addEventListener('click', () => {
      selectedFiles = [];
      updateFileList();
      updateBatchControls();
    });

    // ===== C√°mara (jsQR) =====
    let stream = null;
    let rafId = null;
    const video = document.getElementById('camVideo');
    const canvas = document.getElementById('camCanvas');
    const ctx = canvas?.getContext('2d');
    const btnStartCam = document.getElementById('btnStartCam');
    const btnStopCam = document.getElementById('btnStopCam');
    const camStatus = document.getElementById('camStatus');
    let scanning = false;
    let lastSent = '';

    async function startCam() {
      if (scanning) return;
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false });
        video.srcObject = stream;
        await video.play();
        btnStartCam.disabled = true;
        btnStopCam.disabled = false;
        camStatus.textContent = 'Escaneando...';
        scanning = true;
        tick();
      } catch (e) {
        showMessage(false, 'No se pudo acceder a la c√°mara');
      }
    }

    function stopCam() {
      scanning = false;
      if (rafId) cancelAnimationFrame(rafId);
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      video.pause();
      video.srcObject = null;
      btnStartCam.disabled = false;
      btnStopCam.disabled = true;
      camStatus.textContent = 'Inactiva';
    }

    function tick() {
      if (!scanning) return;
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = window.jsQR ? jsQR(img.data, img.width, img.height, { inversionAttempts: 'attemptBoth' }) : null;
        if (code && code.data && code.data !== lastSent) {
          lastSent = code.data;
          // Registrar directamente por QR textual
          postQR(code.data).then(() => {
            // pausa corta para evitar duplicados seguidos
            setTimeout(() => { lastSent = ''; }, 1000);
          });
        }
      }
      rafId = requestAnimationFrame(tick);
    }

    btnStartCam?.addEventListener('click', startCam);
    btnStopCam?.addEventListener('click', stopCam);

    // ===== Helpers =====
    async function postQR(qrText) {
      const res = await fetch('/procesar_qr', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ qr_data: qrText })
      });
      const data = await res.json();
      showMessage(data.success, data.message || (data.success ? 'Registrado' : 'Error'));
      if (data.tabla_html) refreshTable(data.tabla_html, data.total_registros);
      return data;
    }

    function showMessage(ok, msg) {
      const el = document.getElementById('resultMessage');
      el.className = 'message ' + (ok ? 'success' : 'error');
      el.textContent = msg;
      setTimeout(() => { el.className = 'result-message'; el.textContent = ''; }, 5000);
    }

    function refreshTable(html, total) {
      document.getElementById('tablaRegistros').innerHTML = html;
      document.getElementById('totalRegistros').textContent = total;

      // Reinicializar b√∫squeda y paginaci√≥n
      extractTableData();
      const query = document.getElementById('searchInput')?.value.toLowerCase().trim() || '';
      if (query) {
        renderFilteredTable(query);
      } else {
        currentPage = 1;
        renderFilteredTable('');
      }
    }

    // Limpiar todo
    document.getElementById('btnLimpiar')?.addEventListener('click', async () => {
      if (!confirm('¬øEst√° seguro de que desea limpiar todos los registros?')) return;

      const res = await fetch('/limpiar_registros', { method: 'POST' });
      const data = await res.json();
      showMessage(data.success, data.message || 'Listo');
      if (data.tabla_html) {
        refreshTable(data.tabla_html, 0);
        allRegistros = [];
        initTableFeatures();
      }
    });

    // ===== TABLE SEARCH & PAGINATION =====
    function initTableFeatures() {
      const searchInput = document.getElementById('searchInput');
      const rowsPerPageSelect = document.getElementById('rowsPerPage');

      // Extraer datos de la tabla
      extractTableData();

      // Search
      searchInput?.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        currentPage = 1;
        renderFilteredTable(query);
      });

      // Rows per page
      rowsPerPageSelect?.addEventListener('change', (e) => {
        rowsPerPage = e.target.value === 'all' ? allRegistros.length : parseInt(e.target.value);
        currentPage = 1;
        const query = searchInput?.value.toLowerCase().trim() || '';
        renderFilteredTable(query);
      });
    }

    function extractTableData() {
      const table = document.querySelector('.registros-table');
      if (!table) {
        allRegistros = [];
        return;
      }

      const rows = table.querySelectorAll('tbody tr');
      allRegistros = Array.from(rows).map(row => {
        const cells = row.querySelectorAll('td');
        return {
          numero: cells[0]?.textContent.trim() || '',
          registrado: cells[1]?.textContent.trim() || '',
          curp: cells[2]?.textContent.trim() || '',
          padre: cells[3]?.textContent.trim() || '',
          madre: cells[4]?.textContent.trim() || '',
          municipio: cells[5]?.textContent.trim() || '',
          fechaNac: cells[6]?.textContent.trim() || '',
          horaEscaneo: cells[7]?.textContent.trim() || ''
        };
      });
    }

    function renderFilteredTable(query) {
      let filtered = allRegistros;

      // Filtrar por b√∫squeda
      if (query) {
        filtered = allRegistros.filter(reg => {
          return (
            reg.registrado.toLowerCase().includes(query) ||
            reg.curp.toLowerCase().includes(query) ||
            reg.padre.toLowerCase().includes(query) ||
            reg.madre.toLowerCase().includes(query) ||
            reg.municipio.toLowerCase().includes(query)
          );
        });
      }

      // Paginaci√≥n
      const total = filtered.length;
      const totalPages = Math.ceil(total / rowsPerPage);
      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paged = filtered.slice(start, end);

      // Renderizar tabla
      const tableContainer = document.getElementById('tablaRegistros');
      if (paged.length === 0) {
        tableContainer.innerHTML = '<div class="empty-table" style="padding: 2rem; text-align: center; color: var(--color-muted);">No se encontraron registros</div>';
      } else {
        tableContainer.innerHTML = `
          <div class="table-container">
            <table class="registros-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Registrado</th>
                  <th>CURP</th>
                  <th>Padre</th>
                  <th>Madre</th>
                  <th>Municipio</th>
                  <th>Fecha Nac.</th>
                  <th>Hora Escaneo</th>
                </tr>
              </thead>
              <tbody>
                ${paged.map((reg, idx) => `
                  <tr>
                    <td class="numero">${start + idx + 1}</td>
                    <td>${reg.registrado || '-'}</td>
                    <td class="curp-cell">${reg.curp || '-'}</td>
                    <td>${reg.padre || '-'}</td>
                    <td>${reg.madre || '-'}</td>
                    <td>${reg.municipio || '-'}</td>
                    <td>${reg.fechaNac || '-'}</td>
                    <td>${reg.horaEscaneo || '-'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      }

      // Renderizar paginaci√≥n
      renderPagination(totalPages, total);
    }

    function renderPagination(totalPages, totalRecords) {
      const pagination = document.getElementById('pagination');
      if (!pagination) return;

      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }

      let html = '<button class="pagination-btn" onclick="changePage(1)" ' + (currentPage === 1 ? 'disabled' : '') + '>¬´ Primera</button>';
      html += '<button class="pagination-btn" onclick="changePage(' + (currentPage - 1) + ')" ' + (currentPage === 1 ? 'disabled' : '') + '>‚Äπ Anterior</button>';

      // P√°ginas num√©ricas
      const maxButtons = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxButtons - 1);

      if (endPage - startPage < maxButtons - 1) {
        startPage = Math.max(1, endPage - maxButtons + 1);
      }

      for (let i = startPage; i <= endPage; i++) {
        html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
      }

      html += '<button class="pagination-btn" onclick="changePage(' + (currentPage + 1) + ')" ' + (currentPage === totalPages ? 'disabled' : '') + '>Siguiente ‚Ä∫</button>';
      html += '<button class="pagination-btn" onclick="changePage(' + totalPages + ')" ' + (currentPage === totalPages ? 'disabled' : '') + '>√öltima ¬ª</button>';

      html += `<span class="pagination-info">Mostrando ${((currentPage - 1) * rowsPerPage) + 1}-${Math.min(currentPage * rowsPerPage, totalRecords)} de ${totalRecords}</span>`;

      pagination.innerHTML = html;
    }

    function changePage(page) {
      currentPage = page;
      const query = document.getElementById('searchInput')?.value.toLowerCase().trim() || '';
      renderFilteredTable(query);
    }
  </script>

  <!-- Si usas main.js adicional, mantenlo debajo -->
  <!-- <script src="{{ url_for('static', filename='js/main.js') }}"></script> -->
</body>
</html>

